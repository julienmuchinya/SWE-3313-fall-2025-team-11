<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cart</title>
    <link rel="stylesheet" th:href="@{/css/shopping-cart.css}">
</head>

<body>
<div class="cart-container">

    <!-- MAIN CART COLUMN -->
    <div class="cart-list">

        <div th:each="cartItem : ${cartItems}"
             class="cart-entry"
             th:attr="data-id=${cartItem.id}">

            <h2 class="title" th:text="${cartItem.artPiece.title}"></h2>

            <div class="entry-body">
                <div class="text-block">
                    <div class="price" th:text="${'$' + cartItem.artPiece.price}"></div>
                    <div class="artist" th:text="'Artist: '">add to repo</div>
                    <div class="tags" th:text="${cartItem.artPiece.description}"></div>
                    <button class="remove-btn">Remove</button>
                </div>
                <img class="preview-img"
                     th:src="@{${cartItem.artPiece.imageUrl}}"
                     alt="Artwork">
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const removeButtons = document.querySelectorAll(".remove-btn");

            removeButtons.forEach(btn => {
                btn.addEventListener("click", async (e) => {
                    const entry = e.target.closest(".cart-entry");
                    const id = entry.dataset.id;

                    const response = await fetch(`/cart/remove/${id}`, {
                        method: "DELETE"
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Remove item from page
                        entry.remove();
                    }
                });
            });
        });

    </script>


    <!-- SUMMARY COLUMN -->
    <div class="summary">
        <div class="row">
            <span>Items</span>
            <span id="itemCount" th:text="${cartItemCount}"></span>
        </div>

        <div class="row">
            <span>Subtotal</span>
            <span id="subtotal" th:text="'$' + ${subtotal}"></span>
        </div>

        <a th:href="@{/checkout}" class="checkout-btn">Proceed to Checkout</a>
    </div>
</div>

</body>
</html>
